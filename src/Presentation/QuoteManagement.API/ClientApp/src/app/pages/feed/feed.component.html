
<div class="feed-container">
  <!-- Header Section -->
  <div class="header-section mb-6">
    <div class="flex align-items-center justify-between mb-4">
      <div class="flex align-items-center gap-3">
        <i class="pi pi-book text-primary text-2xl"></i>
        <h1 class="text-3xl font-bold text-900 m-0">Digital Quote Book</h1>
      </div>
      <div class="flex align-items-center gap-3">
        <i class="pi pi-bookmark text-500"></i>
        <span class="text-500">Quote Library</span>
        <i class="pi pi-lightbulb text-500"></i>
        <span class="text-500">Inspiration</span>
        <p-button 
          label="Add Quote" 
          icon="pi pi-plus" 
          (click)="showBookSearchModal = true" 
          styleClass="add-quote-btn" 
          size="small">
        </p-button>
        <i class="pi pi-user text-500"></i>
        <span class="text-500">Sign Out</span>
      </div>
    </div>

    <!-- Search and Filter Section -->
    <div class="search-filter-section">
      <div class="flex align-items-center justify-center gap-4 mb-4">
        <div class="search-container">
          <p-inputgroup styleClass="w-20rem">
            <p-inputgroup-addon>
              <i class="pi pi-search"></i>
            </p-inputgroup-addon>
            <input 
              pInputText 
              placeholder="Search quotes, authors, or sources..." 
              class="w-full" 
              autocomplete="off" />
          </p-inputgroup>
        </div>
      </div>

      <div class="flex align-items-center justify-center gap-2">
        <p-button 
          label="All Quotes" 
          styleClass="filter-btn-active" 
          size="small">
        </p-button>
        <p-button 
          label="With Sources" 
          severity="secondary" 
          outlined 
          size="small">
        </p-button>
        <p-button 
          label="Personal Thoughts" 
          severity="secondary" 
          outlined 
          size="small">
        </p-button>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="grid">
    <div class="col-12 lg:col-4" *ngFor="let item of [1, 2, 3, 4, 5, 6]">
      <div class="card h-full">
        <p-skeleton width="100%" height="120px" styleClass="mb-3"></p-skeleton>
        <p-skeleton width="80%" height="1rem" styleClass="mb-2"></p-skeleton>
        <p-skeleton width="60%" height="1rem" styleClass="mb-3"></p-skeleton>
        <div class="flex justify-between">
          <p-skeleton width="4rem" height="1.5rem"></p-skeleton>
          <p-skeleton width="3rem" height="1.5rem"></p-skeleton>
        </div>
      </div>
    </div>
  </div>

  <!-- Quotes Grid -->
  <div *ngIf="!loading" class="grid">
    <div class="col-12 lg:col-4" *ngFor="let quote of quotes; let i = index">
      <div class="card h-full hover:shadow-3 transition-all transition-duration-200 cursor-pointer">
        <!-- Quote Content -->
        <div class="quote-content mb-4">
          <blockquote class="text-900 font-medium line-height-3 my-0 mb-4">
            "{{ getDisplayedQuoteText(quote) }}"
          </blockquote>

          <!-- Read More/Less Button for Long Quotes -->
          <div class="text-center mb-3" *ngIf="isQuoteLong(quote.quoteText)">
            <p-button
              [label]="isQuoteExpanded(quote.id) ? 'Show less' : 'Read more'"
              severity="secondary"
              size="small"
              text
              (click)="toggleQuoteExpansion(quote.id)"
              styleClass="quote-expand-btn">
            </p-button>
          </div>
        </div>

        <!-- Quote Metadata -->
        <div class="quote-metadata">
          <div class="flex align-items-center gap-2 mb-3">
            <i class="pi pi-bookmark text-primary"></i>
            <span class="text-primary font-medium">Sourced</span>
          </div>

          <!-- Author and Book Info -->
          <div class="source-info mb-3">
            <div class="text-900 font-semibold mb-1">{{ quote.author }}</div>
            <div class="text-600 text-sm">{{ quote.bookName }}</div>
          </div>

          <!-- Date and User Info -->
          <div class="flex align-items-center justify-between">
            <div class="flex align-items-center gap-2">
              <i class="pi pi-calendar text-400 text-xs"></i>
              <span class="text-400 text-xs">{{ quote.datePosted | date: 'MMM d, yyyy' }}</span>
            </div>
            <div class="flex align-items-center gap-2">
              <i class="pi pi-user text-400 text-xs"></i>
              <span class="text-400 text-xs">{{ quote.userNickname }}</span>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex align-items-center justify-between mt-4 pt-3 border-top-1 border-surface-200">
          <div class="flex gap-2">
            <p-button 
              icon="pi pi-heart" 
              [severity]="quote.isLiked ? 'danger' : 'secondary'" 
              size="small" 
              [outlined]="!quote.isLiked" 
              (click)="toggleLike(i)"
              pTooltip="Like quote" 
              tooltipPosition="top">
            </p-button>
            <p-button 
              icon="pi pi-comment" 
              severity="secondary" 
              size="small" 
              outlined 
              pTooltip="Comments" 
              tooltipPosition="top">
            </p-button>
          </div>

          <div class="flex gap-2">
            <p-button 
              icon="pi pi-copy" 
              severity="secondary" 
              size="small" 
              outlined 
              (click)="copyQuote(quote.quoteText)" 
              pTooltip="Copy quote" 
              tooltipPosition="top">
            </p-button>
            <p-button 
              icon="pi pi-bookmark" 
              [severity]="quote.isBookmarked ? 'success' : 'secondary'" 
              size="small" 
              [outlined]="!quote.isBookmarked" 
              (click)="toggleBookmark(i)" 
              pTooltip="Bookmark" 
              tooltipPosition="top">
            </p-button>
            <p-button 
              icon="pi pi-share-alt" 
              severity="secondary" 
              size="small" 
              outlined 
              (click)="shareQuote(quote)" 
              pTooltip="Share quote" 
              tooltipPosition="top">
            </p-button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && quotes.length === 0" class="text-center p-8">
    <i class="pi pi-book text-6xl text-300 mb-4"></i>
    <h3 class="text-xl font-semibold mb-2">No quotes yet</h3>
    <p class="text-500 mb-4">Start building your digital quote collection!</p>
    <p-button 
      label="Add Your First Quote" 
      icon="pi pi-plus" 
      (click)="showBookSearchModal = true">
    </p-button>
  </div>
</div>

<!-- Book Search Modal -->
<p-dialog 
  header="Alıntı Paylaş" 
  [(visible)]="showBookSearchModal" 
  [modal]="true" 
  [closable]="true" 
  [dismissableMask]="true" 
  [style]="{ width: '600px', minHeight: '400px' }" 
  styleClass="book-search-modal">
  <div class="p-6">
    <p-fluid>
      <div class="grid grid-cols-2 gap-4">
        <!-- Search Input -->
        <div class="flex flex-column gap-2">
          <p-inputgroup>
            <p-inputgroup-addon>
              <i class="pi pi-search"></i>
            </p-inputgroup-addon>
            <input 
              pInputText 
              id="bookSearch" 
              [(ngModel)]="bookSearchQuery" 
              (input)="searchBooks()" 
              placeholder="Kitaplarda Ara" 
              class="w-full" 
              autocomplete="off" />
          </p-inputgroup>
        </div>

        <!-- Content Area -->
        <div class="search-content-area" style="min-height: 250px">
          <!-- Initial State -->
          <div *ngIf="!bookSearchQuery && !searchingBooks" class="flex flex-column align-items-center justify-content-center h-full py-6">
            <i class="pi pi-book text-4xl text-300 mb-3 mr-2"></i>
            <div class="flex flex-wrap gap-2 align-items-center justify-content-center">
              <div class="text-400 text-sm">Kitap adı veya yazar adı ile arama yapabilirsiniz</div>
            </div>
          </div>

          <!-- Loading State -->
          <div *ngIf="searchingBooks" class="flex flex-column align-items-center justify-content-center h-full py-6">
            <p-progressSpinner strokeWidth="4" [style]="{ width: '30px', height: '30px' }"></p-progressSpinner>
            <div class="mt-3 text-600 ml-4">Kitaplar aranıyor...</div>
          </div>

          <!-- Empty State -->
          <div *ngIf="!searchingBooks && bookSearchQuery && searchResults.length === 0" class="flex flex-column align-items-center justify-content-center h-full py-6">
            <i class="pi pi-search text-4xl text-300 mb-3"></i>
            <div class="text-600 font-medium mb-2">Arama sonucu bulunamadı</div>
            <div class="text-400 text-sm">Farklı anahtar kelimeler deneyin</div>
          </div>

          <!-- Search Results -->
          <div *ngIf="!searchingBooks && searchResults.length > 0" class="search-results">
            <div class="text-sm text-500 mb-3">{{ searchResults.length }} sonuç bulundu</div>
            <div class="border-1 border-surface-200 border-round overflow-hidden max-h-20rem overflow-y-auto">
              <div
                *ngFor="let book of searchResults; let i = index"
                class="book-result-item p-3 cursor-pointer hover:bg-surface-50 transition-colors transition-duration-150"
                [class.border-bottom-1]="i < searchResults.length - 1"
                [class.border-surface-200]="i < searchResults.length - 1"
                [class.bg-primary-50]="selectedBook?.id === book.id"
                (click)="selectBookAndProceed(book)">
                <div class="flex align-items-start gap-3">
                  <!-- Book Cover -->
                  <div class="book-cover-mini flex-shrink-0" style="width: 48px; height: 72px">
                    <img 
                      [src]="book.coverImageUrl || '/demo/images/ecommerce/blue-book.jpg'" 
                      [alt]="book.title" 
                      class="w-full h-full object-cover border-round shadow-1" 
                      (error)="onBookCoverError($event)" />
                  </div>

                  <!-- Book Info -->
                  <div class="flex-1 min-w-0">
                    <div class="font-semibold text-900 line-height-3 mb-1 text-overflow-ellipsis overflow-hidden white-space-nowrap">
                      {{ book.title }}
                    </div>
                    <div class="text-600 text-sm mb-1" *ngIf="book.author">
                      {{ book.author }}
                    </div>
                    <div class="text-400 text-xs mb-2" *ngIf="book.isbn">ISBN: {{ book.isbn }}</div>
                    <div class="flex align-items-center gap-2">
                      <p-tag [value]="book.quoteCount + ' alıntı'" severity="info" styleClass="text-xs"></p-tag>
                    </div>
                  </div>

                  <!-- Arrow Icon -->
                  <div class="flex-shrink-0 flex align-items-center">
                    <i class="pi pi-chevron-right text-400"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </p-fluid>
  </div>

  <ng-template pTemplate="footer">
    <div class="flex justify-content-end">
      <p-button 
        label="İptal" 
        icon="pi pi-times" 
        (click)="closeBookSearchModal()" 
        text 
        severity="secondary">
      </p-button>
    </div>
  </ng-template>
</p-dialog>

<p-toast></p-toast>
